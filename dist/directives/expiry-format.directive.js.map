{"version":3,"file":"expiry-format.directive.js","sourceRoot":"","sources":["../../src/directives/expiry-format.directive.ts"],"names":[],"mappings":"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","sourcesContent":["import { Directive, ElementRef, HostListener } from '@angular/core';\r\nimport { CreditCard } from '../shared/credit-card';\r\n\r\n@Directive({\r\n  selector: '[ccExp]'\r\n})\r\n\r\nexport class ExpiryFormatDirective {\r\n\r\n  public target;\r\n\r\n  constructor(private el: ElementRef) {\r\n    this.target = this.el.nativeElement;\r\n  }\r\n\r\n  @HostListener('keypress', ['$event']) onKeypress(e) {\r\n    if (CreditCard.restrictNumeric(e)) {\r\n      if (CreditCard.restrictExpiry(e.which, this.target)) {\r\n        this.formatExpiry(e);\r\n        this.formatForwardSlashAndSpace(e);\r\n        this.formatForwardExpiry(e);\r\n      }\r\n    } else {\r\n      e.preventDefault();\r\n      return false;\r\n    }\r\n  }\r\n  @HostListener('keydown', ['$event']) onKeydown(e) {\r\n    if (CreditCard.restrictNumeric(e) && CreditCard.restrictExpiry(e.which, this.target)) {\r\n      this.formatBackExpiry(e);\r\n    }\r\n  }\r\n  @HostListener('change', ['$event']) onChange(e) {\r\n    this.reformatExpiry(e);\r\n  }\r\n  @HostListener('input', ['$event']) onInput(e) {\r\n    this.reformatExpiry(e);\r\n  }\r\n\r\n  private formatExpiry(e) {\r\n    let digit = String.fromCharCode(e.which),\r\n        val   = `${this.target.value}${digit}`;\r\n\r\n    if (!/^\\d+$/.test(digit)) {\r\n      if (/^\\d$/.test(val) && (val !== '0' && val !== '1')) {\r\n        e.preventDefault();\r\n        setTimeout(() => {\r\n          this.target.value = `0${val} / `;\r\n        });\r\n      } else if (/^\\d\\d$/.test(val)) {\r\n        e.preventDefault();\r\n        setTimeout(() => {\r\n          let m1 = parseInt(val[0], 10),\r\n              m2 = parseInt(val[1], 10);\r\n          if (m2 > 2 && m1 !== 0) {\r\n            this.target.value = `0${m1} / ${m2}`;\r\n          } else {\r\n            this.target.value = `${val} / `;\r\n          }\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  private formatForwardSlashAndSpace(e) {\r\n    let which = String.fromCharCode(e.which),\r\n        val   = this.target.value;\r\n\r\n    if (!(which === '/' || which === ' ')) {\r\n      return false;\r\n    }\r\n    if (/^\\d$/.test(val) && val !== '0') {\r\n      this.target.value = `0${val} / `;\r\n    }\r\n  }\r\n\r\n  private formatForwardExpiry(e) {\r\n    let digit = String.fromCharCode(e.which),\r\n        val   = this.target.value;\r\n\r\n    if (!/^\\d+$/.test(digit) && /^\\d\\d$/.test(val)) {\r\n      this.target.value = `${val} / `;\r\n    }\r\n  }\r\n\r\n  private formatBackExpiry(e) {\r\n    let val = this.target.valueOf;\r\n\r\n    if (e.which !== 8) {\r\n      return;\r\n    }\r\n    if ((this.target.selectionStart != null) && this.target.selectionStart !== val.length) {\r\n      return;\r\n    }\r\n    if (/\\d\\s\\/\\s$/.test(val)) {\r\n      e.preventDefault();\r\n      setTimeout(function() {\r\n        this.target.value = val.replace(/\\d\\s\\/\\s$/, '');\r\n      });\r\n    }\r\n  }\r\n\r\n  private reformatExpiry(e) {\r\n    setTimeout(() => {\r\n      let val = this.target.value;\r\n      val = CreditCard.replaceFullWidthChars(val);\r\n      val = CreditCard.formatExpiry(val);\r\n      this.target.selectionStart = this.target.selectionEnd = CreditCard.safeVal(val, this.target);\r\n    });\r\n  }\r\n\r\n}\r\n"]}